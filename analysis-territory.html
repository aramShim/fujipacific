<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="robots" content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1,minimum-scale=1, shrink-to-fit=no, user-scalable=no" />
    <meta name="description" content="fuji pacific 한국 사이트." />

    <!-- iOS 상태바 색상 설정 -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <!-- Android에서 PWA 기능 활성화 -->
    <meta name="theme-color" content="#ffffff" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!--favicon-->
    <link rel="apple-touch-icon" sizes="180x180" href="/src/images/favicon_1/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/src/images/favicon_1/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/src/images/favicon_1/favicon-16x16.png">
    <link rel="manifest" href="/src/images/favicon_1/site.webmanifest">

    <title>Fujipacific</title>

    <!-- Apexcharts -->
    <link rel="stylesheet" href="src/css/apexchart.css" />
    <script src="/src/js/lucide.min.js"></script>

    <!-- CSS HS -->
    <link rel="stylesheet" href="/dist/output.css" />
    <link rel="stylesheet" href="src/css/input.css" />
    <link rel="stylesheet" href="src/css/pretendard.css" />
  </head>
  <body class="hs-overlay-body-open hs-overlay-body-open:overflow-hidden background-color-blue">
    <div class="min-h-screen flex items-start">
      <!-- Mobile Sidebar Overlay -->
      <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"></div>

      <!-- Sidebar -->
      <div
        id="hs-application-sidebar"
        class="hs-overlay [--auto-close:lg] hs-overlay-open:translate-x-0 -translate-x-full transition-all duration-300 transform h-full hidden fixed inset-y-0 start-0 z-[60] bg-white lg:block lg:translate-x-0 lg:end-auto lg:bottom-0 w-64 p-3 background-color-blue"
        role="dialog"
        tabindex="-1"
        aria-label="Sidebar"
      >
        <div class="flex flex-col h-full secondary-nav-container-blue overflow-y-auto shadow-md">
          <!-- sidebar-header -->
          <div class="p-4 py-6">
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-2">
                <a href="/index.html" class="flex items-center">
                  <img src="/src/images/logo3.svg" alt="" class="w-[80%]" />
                </a>
              </div>
            </div>
          </div>

          <!-- Navigation -->
          <nav class="flex-1 p-4 space-y-1 ">
            <a href="/index.html" class="w-full text-start flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg rounded-md text-sm hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white focus:border-r-2 focus:border-blue-400">
              <i data-lucide="bar-chart-3" class="w-4 h-4"></i>
              <span>Summary</span>
            </a>
            <a href="/analysis-song.html" class="w-full text-start flex items-center gap-x-3.5 py-2 px-2.5 text-sm rounded-lg hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white rounded-lg text-blue-600 bg-white border-r-2 border-blue-400">
              <i data-lucide="chart-pie" class="w-4 h-4"></i>
              <span>Analysis</span>
            </a>
            <a href="statement.html" class="w-full text-start flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg rounded-md text-sm hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white focus:border-r-2 focus:border-blue-400" >
              <i data-lucide="receipt-text" class="w-4 h-4"></i>
              <span>Statement</span>
            </a>
            <a href="/overview.html" class="w-full text-start flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg rounded-md text-sm hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white focus:border-r-2 focus:border-blue-400">
              <i data-lucide="globe" class="w-4 h-4"></i>
              <span>Overview</span>
            </a>
            <a href="/contact.html" class="w-full text-start flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg rounded-md text-sm hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white focus:border-r-2 focus:border-blue-400">
              <i data-lucide="mail" class="w-4 h-4"></i>
              <span>Contacts</span>
            </a>
            <div class="hs-accordion" id="system-accordion">
              <button type="button" class="hs-accordion-toggle w-full text-start flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg rounded-md text-sm hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white focus:border-r-2 focus:border-blue-400 ">
                <i data-lucide="user-star" class="w-4 h-4"></i>
                <span>System</span>
                <i data-lucide="chevron-up" class="hs-accordion-active:block ms-auto hidden size-4"></i>
                <i data-lucide="chevron-down" class="hs-accordion-active:hidden ms-auto block size-4"></i>
              </button>
              <div id="system-accordion-child" class="hs-accordion-content w-full overflow-hidden transition-[height] duration-300 hidden" role="region" aria-labelledby="system-accordion">
                <ul class="ps-6 pt-1 space-y-1">
                  <li>
                    <a href="/user-management.html" class="flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white">
                      User Management
                    </a>
                  </li>
                  <li>
                    <a href="/statement-email.html" class="flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white">
                      Statement Email
                    </a>
                  </li>
                  <li>
                    <a href="/email-history.html" class="flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white">
                      Email History
                    </a>
                  </li>
                  <li>
                    <a href="/crawling.html" class="flex items-center gap-x-3.5 py-2 px-2.5 text-sm text-gray-600 rounded-lg hover:bg-white hover:text-blue-600 focus:outline-none focus:text-blue-600 focus:bg-white">
                      Crawling
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </nav>

          <!-- nav-Footer -->
          <div class="p-4 border-t border-gray-200">
            <div class="hs-dropdown [--auto-close:inside] relative flex z-40">
              <button
                id="hs-pro-dnwpd"
                type="button"
                class="group w-full flex items-center py-1 gap-x-2"
                aria-haspopup="menu"
                aria-expanded="false"
                aria-label="Dropdown"
              >
                <div class="w-6 h-6 bg-blue-400 rounded-full flex items-center justify-center">
                  <span class="text-white text-xs">홍</span>
                </div>
                <span class="text-xs text-gray-700">geo890@gmail.com</span>
              </button>
              <div
                class="hs-dropdown-menu hs-dropdown-open:opacity-100 transition-[opacity,margin] duration opacity-0 rounded-xl w-4/5 shadow-[0_10px_40px_10px_rgba(0,0,0,0.08)] hidden z-40 bg-white"
                role="menu"
                aria-orientation="vertical"
                aria-labelledby="hs-pro-dnwpd"
              >
                <div class="py-3 px-5 bg-gray-100 rounded-t-lg">
                  <p class="text-sm font-medium text-gray-800">
                    홍길동님
                  </p>
                  <p class="text-xs text-gray-500">
                    geo890@gmail.com
                  </p>
                </div>

                <div class="p-1.5 space-y-0.5">
                  <a href="/mypage.html" class="flex w-full items-center gap-x-3.5 py-2 px-3 rounded-lg text-sm text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100">
                    <i data-lucide="user-cog" class="shrink-0 size-4"></i>
                    마이페이지
                  </a>
                  <button type="button" class="flex w-full items-center gap-x-3.5 py-2 px-3 rounded-lg text-sm text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100">
                    <i data-lucide="log-out" class="shrink-0 size-4"></i>
                    로그아웃
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="flex-1 flex flex-col w-full lg:ps-64 min-h-screen">
        <!-- Top Header -->
        <header class="bg-white px-4 lg:px-6 py-6 sticky top-0 inset-x-0 z-30 background-color-blue">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-x-4 lg:gap-x-0">
              <button
                type="button"
                class="lg:hidden flex justify-center items-center gap-x-3 size-8 text-sm text-gray-600 hover:bg-gray-100 rounded-full disabled:opacity-50 disabled:pointer-events-none focus:outline-hidden focus:bg-gray-100"
                aria-haspopup="dialog"
                aria-expanded="false"
                aria-controls="hs-sidebar-content-push"
                aria-label="Toggle navigation"
                data-hs-overlay="#hs-application-sidebar"
              >
                <i data-lucide="menu" class="w-5 h-5 text-gray-600"></i>
              </button>
              <h1 class="text-xl font-semibold text-gray-900">Analysis</h1>
            </div>
            <div class="flex items-center space-x-4">
              <!-- Dropdown -->
              <div class="hs-dropdown [--placement:bottom-right] relative inline-flex">
                <button
                  id="hs-dropdown-user"
                  type="button"
                  class="inline-flex justify-center items-center gap-x-2 text-sm rounded-full text-gray-600 hover:text-gray-800 focus:outline-none disabled:opacity-50 disabled:pointer-events-none"
                  aria-haspopup="menu"
                  aria-expanded="false"
                  aria-label="Dropdown"
                >
                  <i data-lucide="circle-user-round" class="shrink-0 size-6"></i>
                </button>

                <div
                  class="hs-dropdown-menu transition-[opacity,margin] duration hs-dropdown-open:opacity-100 opacity-0 hidden min-w-60 bg-white shadow-md rounded-lg mt-2 after:h-4 after:absolute after:-bottom-4 after:start-0 after:w-full before:h-4 before:absolute before:-top-4 before:start-0 before:w-full"
                  role="menu"
                  aria-orientation="vertical"
                  aria-labelledby="hs-dropdown-user"
                >
                  <div class="py-3 px-5 bg-gray-100 rounded-t-lg">
                    <p class="text-sm font-medium text-gray-800">
                      홍길동님
                    </p>
                    <p class="text-xs text-gray-500">
                      geo890@gmail.com
                    </p>
                  </div>
                  <div class="p-1.5 space-y-0.5">
                    <a
                      href="/mypage.html"
                      class="flex w-full items-center gap-x-3.5 py-2 px-3 rounded-lg text-sm text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100"
                    >
                      <i data-lucide="user-cog" class="shrink-0 size-4"></i>
                      마이페이지
                    </a>
                    <button
                      type="button"
                      class="flex w-full items-center gap-x-3.5 py-2 px-3 rounded-lg text-sm text-gray-800 hover:bg-gray-100 focus:outline-none focus:bg-gray-100"
                    >
                      <i data-lucide="log-out" class="shrink-0 size-4"></i>
                      로그아웃
                    </button>
                  </div>
                </div>
              </div>
              <!-- End Dropdown -->
            </div>
          </div>
        </header>

        <!-- Content -->
        <main class="flex-1 px-4 lg:px-6 pb-6">
          <div class="h-full">
            <div class="inline-flex bg-blue-100 rounded-lg transition p-2 shadow-sm">
              <nav class="flex gap-x-1">
                <a href="analysis-song.html" class="py-2 px-4 inline-flex items-center gap-x-1 bg-transparent text-sm text-gray-400 hover:text-gray-700 focus:outline-hidden focus:text-gray-700 font-medium rounded-lg hover:bg-white/50 disabled:opacity-50 disabled:pointer-events-none">
                  <i data-lucide="music-4" class="size-4"></i>Song
                </a>
                <a href="analysis-territory.html" class="bg-white text-blue-600 shadow-sm py-2 px-4 inline-flex items-center gap-x-1 text-sm hover:text-gray-700 focus:outline-hidden focus:text-gray-700 font-medium rounded-lg hover:bg-white/50">
                  <i data-lucide="map" class="size-4"></i>Territory
                </a>
                <a href="analysis-type.html" class="py-2 px-4 inline-flex items-center gap-x-1 bg-transparent text-sm text-gray-400 hover:text-gray-700 focus:outline-hidden focus:text-gray-700 font-medium rounded-lg hover:bg-white/50 disabled:opacity-50 disabled:pointer-events-none">
                  <i data-lucide="tag" class="size-4"></i>Type
                </a>
                <a href="analysis-source.html" class="py-2 px-4 inline-flex items-center gap-x-1 bg-transparent text-sm text-gray-400 hover:text-gray-700 focus:outline-hidden focus:text-gray-700 font-medium rounded-lg hover:bg-white/50 disabled:opacity-50 disabled:pointer-events-none">
                  <i data-lucide="scroll-text" class="size-4"></i>Source
                </a>
              </nav>
            </div>

            <div class="mt-3">
              
                <div class="pb-3 flex items-start flex-col justify-between gap-2 md:flex-row md:items-center sticky top-[76px] z-[2]" style="background-color: #fafafa">                    
                    <select class="py-2 px-4 pe-9 block border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-blue-500 disabled:opacity-50 disabled:pointer-events-none">
                        <option>select period</option>
                        <option value="2Q2025">2Q2025</option>
                        <option value="1Q2025">1Q2025</option>
                        <option value="4Q2024">4Q2024</option>
                        <option value="3Q2024">3Q2024</option>
                        <option value="2Q2024">2Q2024</option>
                        <option value="1Q2024">1Q2024</option>
                        <option value="4Q2023">4Q2023</option>
                        <option value="3Q2023">3Q2023</option>
                        <option value="2Q2023">2Q2023</option>
                        <option value="1Q2023">1Q2023</option>
                        <option value="4Q2022">4Q2022</option>
                        <option value="3Q2022">3Q2022</option>
                        <option value="2Q2022">2Q2022</option>
                        <option value="1Q2022">1Q2022</option>
                        <option value="4Q2021">4Q2021</option>
                        <option value="3Q2021">3Q2021</option>
                        <option value="2Q2021">2Q2021</option>
                        <option value="1Q2021">1Q2021</option>
                    </select>
                </div>
                
                
                 <!-- Grid -->
                <div class="flex flex-col lg:flex-row gap-4 w-full">
                    <div class="lg:w-[40%] bg-white border shadow-sm rounded-xl">
                        <!-- Card -->                   
                        <div class="p-4 md:p-5 overflow-auto">
                            <div class="flex items-center gap-x-2">
                                <h3 class="text-md font-semibold text-gray-800">Breakdown by Territory</h3>
                            </div>
                            <div class="mt-4 flex items-center">
                                <div id="top-territory" class="space-y-2 w-full"></div>
                            </div>
                        </div>                        
                    </div>
                    
                     <div class="lg:w-[60%]">
                        <div class="p-4 md:p-5 bg-white border shadow-sm rounded-xl overflow-x-auto">
                            <div class="flex items-center gap-x-2">
                                <h3 class="text-md font-semibold text-gray-800">Top Songs : ALL TERRITORIES</h3>
                            </div>
                            <div class="mt-1">
                                <div class="flex items-center justify-center w-full gap-x-12 flex-col lg:flex-row sm:flex-row ">
                                    <div class="h-[300px] aspect-square p-4">
                                        <canvas id="type-donut" class="w-full h-full"></canvas>
                                    </div>
                                    <div id="type-legend" class=""></div>
                                </div>
                            </div>
                        </div>

                        <!-- End Card -->
                        <div class="p-4 md:p-5 bg-white border shadow-sm rounded-xl overflow-x-auto mt-4">
                            <div class="flex items-center gap-x-2">
                                <h3 class="text-md font-semibold text-gray-800">Breakdown by Type</h3>
                            </div>
                            <div class="mt-4 flex items-center justify-center lg:h-[450px]">
                                <div id="world-map" class="w-[80%] h-full relative"></div>
                            </div>                    
                        </div>
                     </div>        
                </div>
             
            </div>
            
          </div>
        </main>

        <!-- Footer-->
        <footer class="w-full px-6 py-4 mt-auto">
          <div class="flex w-full items-center justify-between">
            <p class="text-gray-400 text-xs">
              © 1998-2025 FUJIPACIFIC. ALL RIGHTS RESERVED.
            </p>
          </div>
        </footer>
        <!-- End Footer -->
      </div>
    </div>
    <!--footer-->

    <!--loader-->
    <div class="loader-wrap bg-[rgba(0,0,0,.6)] flex items-center justify-center" id="spinLoader" style="display:none;">
      <span class="loader after:border-neutral-200 before:border-neutral-200"></span>
    </div>

    <!-- JS PLUGINS -->
    <script src="/src/js/preline.min.js" crossorigin="anonymous" defer></script>

    <!--차트-->
    <link rel="stylesheet" href="src/css/Chart.css">
    <script src="src/js/chart.js"></script>

    <!--세계지도-->
    <script src="src/js/d3.min.js"></script>
    <script src="src/js/topojson.min.js"></script>
    <script src="src/js/datamaps.world.min.js"></script>
    
    <script>
      /** 데이터 */
      const labels = ['Performance', 'Digital', 'Mechanical', 'Sync', 'Others'];
      const values = [56059, 63000, 50000, 300000, 355000];
      const colors = [
        '#ff3fa0', // Performance (핑크)
        '#f5a623', // Digital (오렌지)
        '#1cc7c1', // Mechanical (민트)
        '#27ae60', // Sync (그린)
        '#c3c7cf'  // Others (그레이)
      ];

      // 합계/비율 계산
      const total = values.reduce((a, b) => a + b, 0);
      const pct = v => (total ? (v / total) * 100 : 0);

      // 통화 포매터
      const fmtMoney = new Intl.NumberFormat('ko-KR', { style: 'currency', currency: 'KWR', maximumFractionDigits: 2 });
      const fmtCompact = new Intl.NumberFormat('ko-KR', { notation: 'compact', maximumFractionDigits: 1 });

      /** 중앙 텍스트 플러그인 */
      const centerText = {
        id: 'centerText',
        afterDraw(chart, args, opts) {
          const { ctx, chartArea: { top, bottom, left, right } } = chart;
          const x = (left + right) / 2;
          const y = (top + bottom) / 2;

          ctx.save();
          ctx.textAlign = 'center';
          ctx.fillStyle = '#999';
          ctx.font = '600 12px Pretendard, system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
          ctx.fillText('TOTAL', x, y - 8);
          ctx.fillStyle = '#333';
          ctx.font = '700 16px Pretendard, system-ui, -apple-system, Segoe UI, Roboto, sans-serif';
          ctx.fillText('KRW ' + fmtCompact.format(total), x, y + 14);
          ctx.restore();
        }
      };

      const ctx = document.getElementById('type-donut').getContext('2d');
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{
            data: values,
            backgroundColor: colors,
            borderWidth: 0,
            hoverOffset: 4
          }]
        },
        options: {
          responsive: true,
          cutout: '70%',                 // 도넛 두께
          plugins: {
            legend: { display: false },  // 기본 레전드 숨김
            tooltip: {
              callbacks: {
                label: (ctx) => {
                  const v = ctx.parsed;
                  return ` ${ctx.label}: ${fmtMoney.format(v)} (${pct(v).toFixed(2)}%)`;
                }
              }
            }
          }
        },
        plugins: [centerText]
      });

      /** 커스텀 레전드 HTML */
      const legendWrap = document.getElementById('type-legend');
      legendWrap.innerHTML = labels.map((name, i) => {
        const v = values[i];
        return `
          <div class="flex items-center gap-2 p-1">
            <span class="rounded-full inline-block w-[8px] h-[8px]" style="background:${colors[i]}"></span>
            <span class="flex-1 text-gray-800 text-sm w-[110px]">${name}</span>
            <span class="text-gray-600 text-sm"><span class="text-xs">KRW</span> <b>${v.toLocaleString('ko-KR')}</b></span>
            <span class="text-right text-gray-600 text-xs">${pct(v).toFixed(2)}%</span>
          </div>
        `;
      }).join('');
    </script>
    <script>

      const territories = [
        { name: 'Japan',     value: 173262 },
        { name: 'Taiwan',    value: 144709 },
        { name: 'China',     value: 42316 },
        { name: 'Malaysia',  value: 41082 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
        { name: 'Singapore', value: 14301 },
      ];

      const max = Math.max(...territories.map(t => t.value));
      const fmt  = new Intl.NumberFormat('ko-KR');
      const wrap = document.getElementById('top-territory');
      

      wrap.innerHTML = territories.map(t => {
        const w = (t.value / max) * 100;
        return `
          <div class="relative overflow-hidden rounded-lg z-[1] cursor-pointer hover:scale-[101%] hover:shadow-md" style="transition:all .1s;">
            <!-- 트랙 -->
            <div class="absolute inset-0 bg-gray-400"></div>
            <!-- 진행바 -->
            <div class="absolute inset-y-0 left-0 rounded-lg bg-blue-500 bar-fill"></div>
            <!-- 내용 -->
            <div class="relative flex items-center justify-between px-4 py-3 text-white">
              <span class="text-sm font-bold">${t.name}</span>
              <span class="text-sm text-white font-bold">
                <span class="mr-2 text-xs font-normal text-neutral-200">KRW</span>${fmt.format(t.value)}
              </span>
            </div>
          </div>
        `;
      }).join('');
      
      // 애니메이션 
      setTimeout(() => {
        document.querySelectorAll('.bar-fill').forEach((bar, i) => {
          const w = (territories[i].value / max) * 100;
          bar.style.width = w + '%';
        });
      }, 100);

      // 국가명 -> ISO3 코드 매핑 (Datamaps는 ISO3 사용)
        const nameToISO3 = {
            'Japan': 'JPN',
            'Taiwan': 'TWN',
            'China': 'CHN',
            'Malaysia': 'MYS',
            'Singapore': 'SGP',
            // 필요 시 여기에 계속 추가
        };

        const maxVal = Math.max.apply(null, territories.map(t => t.value));
        const colorScale = d3.scale.linear()
            .domain([0, maxVal])
            .range(['#dbeafe', '#3b82f6']); // startColor, endColor

        // Datamaps의 data 형식으로 변환
        const dataSet = {};
        territories.forEach(t => {
            const iso3 = nameToISO3[t.name];
            if (!iso3) return;
            dataSet[iso3] = {
                value: t.value,
                fillColor: colorScale(t.value)
            };
        });

        const container = document.querySelector('#world-map');

        // 커스텀 툴팁 DOM 추가
        const tip = document.createElement('div');
        tip.id = 'map-tooltip';
        Object.assign(tip.style, {
            position:'absolute', display:'none', pointerEvents:'none',
            zIndex:20
        });
        container.appendChild(tip);

        const money = new Intl.NumberFormat('ko-KR');

        const map = new Datamap({
            element: document.getElementById('world-map'),
            projection: 'mercator',
            responsive: true,
            fills: { defaultFill: '#d1d5db', MAJOR: '#9ca3af' },
            data: dataSet,
            geographyConfig: {
            borderColor: 'rgba(0,0,0,.09)',
            borderWidth: 1,
            highlightOnHover: false,
            popupOnHover: false
            },
            done: function(datamap){
            const svg = datamap.svg;

            // 툴팁 위치 조절값 & 모드
            const offsetX = 12;        // X 오프셋
            const offsetY = -28;       // Y 오프셋
            const positionMode = 'cursor'; // 'cursor' | 'centroid'

            
            svg.selectAll('.datamaps-subunit')
                .style('cursor', d => dataSet[d.id] ? 'pointer' : 'default')
                .on('mouseover', function(geo){
                const data = dataSet[geo.id];
                if (!data) return; // ★ 값 없는 국가는 hover 없음

                // 하이라이트(원래 색 보관 후 파랑으로)
                const pre = this.style.fill || '#9ca3af';
                this.setAttribute('data-pre-fill', pre);
                this.style.fill = '#3b82f6';

                // 툴팁 내용
                tip.innerHTML = `
                    <div class="bg-white rounded-xl shadow-xl w-37.5 p-3">
                        <div class="mb-1">              
                            <span class="text-sm font-medium whitespace-nowrap">${geo.properties.name}</span>
                        </div>
                        <div class="flex items-center gap-x-2">
                            <span class="text-xs text-gray-500">KWR</span>
                            <span class="text-sm font-medium">${data.value}</span>                        
                        </div>                        
                    </div>
                `;
                tip.style.display = 'block';
                })
                .on('mousemove', function(geo){
                const data = dataSet[geo.id];
                if (!data) return;

                let x, y;
                if (positionMode === 'centroid') {
                    // 국가 중심(픽셀 좌표)
                    const c = dataMap.path.centroid(geo);
                    x = c[0] + offsetX;
                    y = c[1] + offsetY;
                } else {
                    // 마우스 기준
                    const e = d3.event;
                    const rect = container.getBoundingClientRect();
                    x = e.clientX - rect.left + offsetX;
                    y = e.clientY - rect.top  + offsetY;
                }
                tip.style.left = x + 'px';
                tip.style.top  = y + 'px';
                })
                .on('mouseout', function(){
                // 원래 색상 복구 & 툴팁 숨김
                const pre = this.getAttribute('data-pre-fill');
                if (pre) this.style.fill = pre;
                tip.style.display = 'none';
                });
            }
            
        });

        // 4) 데이터 업데이트(선택) — 새 배열로 갱신하고 싶을 때 사용
        function updateTerritories(newList) {
            const max = Math.max.apply(null, newList.map(t => t.value));
            const scale = d3.scale.linear().domain([0, max]).range(['#e5e7eb', '#0f3e4a']);
            const next = {};
            newList.forEach(t => {
                const iso3 = nameToISO3[t.name];
                if (!iso3) return;
                next[iso3] = { value: t.value, fillColor: scale(t.value) };
            });
            map.updateChoropleth(next, { reset: true });
        }


        window.addEventListener('resize', function () {
            map.resize();
        });

    </script>
 

    <script>
      window.addEventListener("load", () => {
        lucide.createIcons();
        window.HSStaticMethods.autoInit();
      });
    </script>
  </body>
</html>
